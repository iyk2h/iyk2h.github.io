

### 동시성 제어

두 개 이상의 트랜잭션이 동시에 수행될 때 일관성을 해치지 않도록 트랜잭션의 데이터 접근을 제어하는 DBMS의 기능

| T1   | T2   | 발생 문제                                   | 동시 접근           |
| ---- | ---- | ------------------------------------------- | ------------------- |
| 읽기 | 읽기 | 없음(읽기만 하면 아무 문제 없다)            | 허용                |
| 쓰기 | 쓰기 | 갱신손실                                    | 허용불가(LOCK 이용) |
| 읽기 | 쓰기 | 오손 읽기, 반복불가능 읽기, 유령데이터 읽기 | 허용/불가 중 선택   |



### 갱신손실 문제 ( 절대 허용 X )

| T1   | T2   | 발생 문제 | 동시 접근           |
| ---- | ---- | --------- | ------------------- |
| 쓰기 | 쓰기 | 갱신손실  | 허용불가(LOCK 이용) |

두 개의 트랜잭션이 한 개의 데이터를 동시에 갱신할 때 발생

트랜잭션 T1, 트랜잭션 T2 가 동시에 한 개의 데이터를 동시에 갱신할 때, T2가 T1이 갱신 준비중인 값을 가져와 갱신했을때 갱신이 동시에 발생하는 문제

### 갱신손실 해결

#### 락

자신이 데이터를 수정중이라는 사실을 알리는 방법으로 데이터를 사용하는 동안 잠금장치를 걸어두는 기능

락은 두 가지 유형을 가지고 있다.

- shared lock LS 공유락
	- 읽기를 할 때 사용하는 락
- exclusive lock LX 배타락
	- 읽고 쓰기를 할 때 사용하는 락

일기만 하면 LS 요청, 읽거나 쓰기를 하면 LX 요청

|        | LS상태 | LX상태 |
| ------ | ------ | ------ |
| LS요청 | 허용   | 대기   |
| LX요청 | 대기   | 대기   |

#### 2단계 락킹 - 2 phase locking

확장단계 - 필요한 락을 획득하는 단계, 이미 획득한 락을 해제하지 않는다. 

수축단계 - 락을 해제하는 단계로, 새로운 락을 획득하지 않는다.

ex) 트랜잭션이 데이터를 A,B를 둘 다 사용할 경우 LX(A) 의 락을 미리 해제하면 안 된다.

| T1                                   | T2                  |
| ------------------------------------ | ------------------- |
| LX(A)<br />...                       |                     |
|                                      | LX(A)<br />대기상태 |
| LX(B)<br />...<br />UN(A)<br />UN(B) |                     |
|                                      | LX(A)<br />...      |



#### 데드락

2단계 락킹 기법을 사용할 때 두 개 이상의 트랜잭션이 각각 자신의 데이터에 대하여 락을 획득하고 상대방 데이터에 대하여 락을 요청하면 무한 대기에 빠진 생태

##### 데드락 해결

DMBS가 T1 혹은 T2의 작업 중 하나를 강제로 중지. 중지시킨 트랜잭션이 변경한 값은 원래 상태로 바꾸어 놓는다.

